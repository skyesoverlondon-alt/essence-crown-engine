<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Essence Crown – Shard Wars Board Demo</title>
  <style>
    :root {
      --purple-soft: #1f1635;
      --purple-bright: #7c3aed;
      --gold-soft: #fbbf24;
      --bg-deep: #030712;
      --fg-soft: #e5e7eb;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827, #020617 60%);
      color: var(--fg-soft);
      margin: 0;
      padding: 0;
    }

    h1 {
      text-align: center;
      margin: 12px 0 4px;
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: #fef9c3;
      text-shadow: 0 0 12px rgba(250, 250, 210, 0.4);
    }

    #app {
      max-width: 1100px;
      margin: 0 auto 24px;
      padding: 10px;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 10px;
    }

    button {
      border-radius: 999px;
      border: 1px solid rgba(248, 250, 252, 0.14);
      background: radial-gradient(circle at top left, #7c3aed, #4c1d95);
      color: #f9fafb;
      padding: 6px 14px;
      font-size: 0.82rem;
      cursor: pointer;
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.6), 0 10px 20px rgba(15, 23, 42, 0.9);
      text-transform: uppercase;
      letter-spacing: 0.09em;
    }

    button:disabled {
      opacity: 0.45;
      cursor: default;
      background: #111827;
      border-color: #4b5563;
      box-shadow: none;
    }

    .turn-indicator {
      text-align: center;
      font-size: 0.78rem;
      color: #9ca3af;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.16em;
    }

    /* Board + background image */

    .board-wrapper {
      display: flex;
      justify-content: center;
      margin-bottom: 10px;
    }

    .board-image {
      position: relative;
      width: 100%;
      max-width: 980px;
      /* 24x28in ≈ 24:28 ratio */
      aspect-ratio: 24 / 28;
      background-image: url("EssenceCrown_2Player_Tabletop_v3_24x28in_300dpi.png");
      /* ^ If your filename is different, change it here */
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      border-radius: 18px;
      overflow: hidden;
      box-shadow: 0 30px 60px rgba(0, 0, 0, 0.9);
    }

    /* Player overlays sitting on top of your printed zones */

    .player-overlay {
      position: absolute;
      left: 6%;
      right: 6%;
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.72rem;
      color: #f9fafb;
    }

    .player-overlay.top {
      top: 7%;
    }

    .player-overlay.bottom {
      bottom: 7%;
    }

    .player-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      text-shadow: 0 0 8px rgba(0, 0, 0, 0.75);
    }

    .player-name {
      font-weight: 600;
      font-size: 0.9rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
    }

    .badge-active {
      font-size: 0.65rem;
      padding: 2px 7px;
      border-radius: 999px;
      border: 1px solid var(--gold-soft);
      background: radial-gradient(circle at top left, #facc15, #92400e);
      color: #111827;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .overlay-stats {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .stat-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.88);
      border: 1px solid rgba(148, 163, 184, 0.6);
    }

    .overlay-zones {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 2px;
    }

    .zone-pill {
      padding: 2px 7px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px dashed rgba(148, 163, 184, 0.7);
      font-size: 0.7rem;
      max-width: 40%;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Active player hand, sits under the board (Your Hand Below Edge) */

    .hand-wrapper {
      margin: 8px auto 10px;
      max-width: 980px;
      padding: 6px 8px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.96), #020617);
      box-shadow: 0 18px 32px rgba(15, 23, 42, 0.8);
    }

    .hand-title {
      font-size: 0.76rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .hand-cards {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .card-button {
      font-size: 0.72rem;
      padding: 4px 9px;
      border-radius: 999px;
      border: 1px solid rgba(96, 165, 250, 0.9);
      background: radial-gradient(circle at top left, #0f172a, #020617);
      color: #e5e7eb;
      cursor: pointer;
      white-space: nowrap;
    }

    .card-button:disabled {
      opacity: 0.4;
      cursor: default;
      border-color: #4b5563;
      background: #020617;
    }

    /* Combat log */

    .log {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, #020617, #020617);
      font-size: 0.78rem;
      max-height: 180px;
      overflow-y: auto;
      line-height: 1.3;
    }

    .log-title {
      font-size: 0.74rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #9ca3af;
      margin-bottom: 4px;
    }

    .log-line {
      color: #e5e7eb;
    }

    @media (max-width: 640px) {
      .player-overlay {
        font-size: 0.68rem;
      }

      .stat-pill,
      .zone-pill {
        font-size: 0.68rem;
      }

      .card-button {
        font-size: 0.68rem;
      }
    }
  </style>
</head>
<body>
  <h1>Essence Crown: Shard Wars</h1>
  <div id="app"></div>

  <script>
    // ------------------------
    // Lightweight board model
    // (keeps browser demo separate from TS engine)
    // ------------------------

    function createDeity(ownerId, startingEssence, baseKl) {
      return {
        id: "DEITY-" + ownerId,
        name: "Deity of " + ownerId,
        essence: startingEssence,
        baseKl: baseKl
      };
    }

    function createShard(ownerId, index, klCost) {
      return {
        id: "SHARD-" + ownerId + "-" + index,
        ownerId,
        name: "Shard " + index,
        type: "Shard",
        klCost: klCost,
        power: 0,
        guard: 0,
        tapped: false
      };
    }

    function createAvatar(ownerId, index, power, guard, klCost) {
      return {
        id: "AVATAR-" + ownerId + "-" + index,
        ownerId,
        name: "Avatar " + index,
        type: "Avatar",
        klCost,
        power,
        guard,
        tapped: false
      };
    }

    function createVeiledDeck(ownerId) {
      const deck = [];
      for (let i = 0; i < 3; i++) {
        deck.push(createShard(ownerId, i, 1));
      }
      deck.push(createAvatar(ownerId, 0, 2, 2, 2));
      deck.push(createAvatar(ownerId, 1, 3, 2, 3));
      deck.push(createAvatar(ownerId, 2, 4, 3, 4));
      // shuffle
      for (let i = deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    function createPlayer(id, startingEssence, baseKl) {
      const deity = createDeity(id, startingEssence, baseKl);
      return {
        id,
        name: id === "P1" ? "Player One" : "Player Two",
        deity,
        essence: deity.essence,
        baseKl: deity.baseKl,
        currentKl: deity.baseKl,
        godCharges: 0,
        veiledDeck: createVeiledDeck(id),
        hand: [],
        shardRow: [],
        avatarLine: [],
        crypt: [],
        nullZone: [],
        klCap: 31
      };
    }

    const game = {
      players: [
        createPlayer("P1", 23, 3),
        createPlayer("P2", 21, 3)
      ],
      activeIndex: -1,
      turnNumber: 0,
      log: []
    };

    function activePlayer() {
      return game.activeIndex === -1 ? null : game.players[game.activeIndex];
    }

    function opponentOf(player) {
      return game.players.find(p => p.id !== player.id);
    }

    function logLine(text) {
      const stamp = "[T" + game.turnNumber + "]";
      game.log.push(stamp + " " + text);
      if (game.log.length > 80) game.log.shift();
    }

    // ------------------------
    // Turn + actions
    // ------------------------

    function drawCard(player) {
      if (player.veiledDeck.length === 0) return;
      const card = player.veiledDeck.shift();
      player.hand.push(card);
    }

    function recalcKl(player) {
      const shardBonus = player.shardRow.length;
      const base = player.baseKl + shardBonus;
      player.currentKl = Math.min(base, player.klCap);
    }

    function checkGodCharge(player) {
      if (player.currentKl >= 13 && player.godCharges < 3) {
        player.godCharges += 1;
        logLine(player.name + " reached KL 13+ and gained a God Charge (" + player.godCharges + ")");
      }
    }

    function readyBoard(player) {
      player.avatarLine.forEach(card => {
        card.tapped = false;
      });
    }

    function startNextTurn() {
      if (game.activeIndex === -1) {
        game.activeIndex = 0;
        game.turnNumber = 1;
      } else {
        game.activeIndex = (game.activeIndex + 1) % game.players.length;
        game.turnNumber += 1;
      }

      const p = activePlayer();
      const opp = opponentOf(p);

      readyBoard(p);
      drawCard(p);
      recalcKl(p);
      checkGodCharge(p);

      logLine(
        p.name +
          " begins their turn. Essence: " +
          p.essence +
          ", KL: " +
          p.currentKl +
          ", God Charges: " +
          p.godCharges
      );

      if (opp && opp.essence <= 0) {
        logLine(opp.name + " has 0 Essence. Game over.");
      }

      render();
    }

    function playCardFromHand(cardId) {
      const p = activePlayer();
      if (!p) return;

      const idx = p.hand.findIndex(c => c.id === cardId);
      if (idx === -1) return;
      const card = p.hand[idx];

      const cost = card.klCost || 0;
      if (p.currentKl < cost) {
        logLine(
          p.name +
            " tried to play " +
            card.name +
            " but lacks KL (" +
            p.currentKl +
            "/" +
            cost +
            ")."
        );
        render();
        return;
      }

      p.currentKl -= cost;
      p.hand.splice(idx, 1);

      if (card.type === "Shard") {
        p.shardRow.push(card);
        logLine(p.name + " played Shard: " + card.name + " (KL -" + cost + ")");
      } else if (card.type === "Avatar") {
        card.tapped = false;
        p.avatarLine.push(card);
        logLine(p.name + " played Avatar: " + card.name + " (KL -" + cost + ")");
      } else {
        logLine(p.name + " played " + card.name + " (type " + card.type + ")");
      }

      recalcKl(p);
      render();
    }

    function attackWithAll() {
      const p = activePlayer();
      if (!p) return;
      const opp = opponentOf(p);
      if (!opp) return;

      const attackers = p.avatarLine.filter(c => !c.tapped && (c.power || 0) > 0);
      if (attackers.length === 0) {
        logLine(p.name + " has no untapped Avatars to attack with.");
        render();
        return;
      }

      let totalDamage = 0;
      attackers.forEach(c => {
        totalDamage += c.power || 0;
        c.tapped = true;
      });

      opp.essence = Math.max(0, opp.essence - totalDamage);
      logLine(
        p.name +
          " attacks with " +
          attackers.length +
          " Avatar(s) for " +
          totalDamage +
          " Essence damage to " +
          opp.name +
          "."
      );

      if (opp.essence <= 0) {
        logLine(opp.name + " has been reduced to 0 Essence. Game over.");
      }

      render();
    }

    function resetGame() {
      game.players = [
        createPlayer("P1", 23, 3),
        createPlayer("P2", 21, 3)
      ];
      game.activeIndex = -1;
      game.turnNumber = 0;
      game.log = [];
      logLine("New game started.");
      render();
    }

    // ------------------------
    // Rendering tied to your 2-player board art
    // ------------------------

    function buildPlayerOverlay(p, index) {
      const overlay = document.createElement("div");
      overlay.className = "player-overlay " + (index === 0 ? "bottom" : "top");

      const header = document.createElement("div");
      header.className = "player-header";

      const nameEl = document.createElement("div");
      nameEl.className = "player-name";
      nameEl.textContent = p.name + " (" + p.id + ")";
      header.appendChild(nameEl);

      if (index === game.activeIndex) {
        const badge = document.createElement("div");
        badge.className = "badge-active";
        badge.textContent = "Active";
        header.appendChild(badge);
      }

      overlay.appendChild(header);

      const stats = document.createElement("div");
      stats.className = "overlay-stats";

      function makeStat(text) {
        const pill = document.createElement("div");
        pill.className = "stat-pill";
        pill.textContent = text;
        return pill;
      }

      stats.appendChild(makeStat("Essence: " + p.essence));
      stats.appendChild(makeStat("KL: " + p.currentKl + " / " + p.klCap));
      stats.appendChild(makeStat("Base KL: " + p.baseKl));
      stats.appendChild(makeStat("God Charges: " + p.godCharges));
      stats.appendChild(makeStat("Hand: " + p.hand.length));
      stats.appendChild(makeStat("Deck: " + p.veiledDeck.length));

      overlay.appendChild(stats);

      const zones = document.createElement("div");
      zones.className = "overlay-zones";

      const shards = document.createElement("div");
      shards.className = "zone-pill";
      shards.textContent =
        "Relics / Shards: " + (p.shardRow.length || 0);
      zones.appendChild(shards);

      const avatars = document.createElement("div");
      avatars.className = "zone-pill";
      avatars.textContent =
        "Avatars in Field: " + (p.avatarLine.length || 0);
      zones.appendChild(avatars);

      const crypt = document.createElement("div");
      crypt.className = "zone-pill";
      crypt.textContent = "Crypt: " + (p.crypt.length || 0);
      zones.appendChild(crypt);

      overlay.appendChild(zones);

      return overlay;
    }

    function render() {
      const app = document.getElementById("app");
      app.innerHTML = "";

      // Controls
      const controls = document.createElement("div");
      controls.className = "controls";

      const btnTurn = document.createElement("button");
      btnTurn.textContent =
        game.activeIndex === -1 ? "Start Game (P1 Turn 1)" : "Next Turn";
      btnTurn.onclick = startNextTurn;
      controls.appendChild(btnTurn);

      const btnAttack = document.createElement("button");
      btnAttack.textContent = "Attack With All Avatars";
      btnAttack.onclick = attackWithAll;
      btnAttack.disabled = activePlayer() === null;
      controls.appendChild(btnAttack);

      const btnReset = document.createElement("button");
      btnReset.textContent = "Reset Game";
      btnReset.onclick = resetGame;
      controls.appendChild(btnReset);

      app.appendChild(controls);

      const turnIndicator = document.createElement("div");
      turnIndicator.className = "turn-indicator";
      if (game.turnNumber === 0) {
        turnIndicator.textContent = "Turn: (not started)";
      } else {
        const p = activePlayer();
        turnIndicator.textContent =
          "Turn " +
          game.turnNumber +
          " – Active: " +
          (p ? p.name : "?");
      }
      app.appendChild(turnIndicator);

      // Board with your 2-player art
      const boardWrapper = document.createElement("div");
      boardWrapper.className = "board-wrapper";

      const boardImage = document.createElement("div");
      boardImage.className = "board-image";

      game.players.forEach((p, index) => {
        const overlay = buildPlayerOverlay(p, index);
        boardImage.appendChild(overlay);
      });

      boardWrapper.appendChild(boardImage);
      app.appendChild(boardWrapper);

      // Active player's hand (below the board, matches "hand off-mat" line)
      const pActive = activePlayer();
      const handWrap = document.createElement("div");
      handWrap.className = "hand-wrapper";

      const handTitle = document.createElement("div");
      handTitle.className = "hand-title";
      handTitle.textContent = pActive
        ? "Active Hand – " + pActive.name + " (" + pActive.id + ")"
        : "Active Hand – (start the game to draw cards)";
      handWrap.appendChild(handTitle);

      const handRow = document.createElement("div");
      handRow.className = "hand-cards";

      if (pActive) {
        pActive.hand.forEach(card => {
          const btn = document.createElement("button");
          btn.className = "card-button";
          btn.textContent =
            card.name +
            " [" +
            card.type +
            " | KL " +
            (card.klCost || 0) +
            "]";
          const canAfford = pActive.currentKl >= (card.klCost || 0);
          btn.disabled = !canAfford;
          btn.onclick = function () {
            playCardFromHand(card.id);
          };
          handRow.appendChild(btn);
        });

        if (pActive.hand.length === 0) {
          const empty = document.createElement("div");
          empty.style.fontSize = "0.72rem";
          empty.style.color = "#9ca3af";
          empty.textContent = "No cards in hand yet (draw happens at the start of your turn).";
          handRow.appendChild(empty);
        }
      }

      handWrap.appendChild(handRow);
      app.appendChild(handWrap);

      // Log
      const logBox = document.createElement("div");
      logBox.className = "log";

      const logTitle = document.createElement("div");
      logTitle.className = "log-title";
      logTitle.textContent = "Combat Log";
      logBox.appendChild(logTitle);

      game.log.forEach(line => {
        const div = document.createElement("div");
        div.className = "log-line";
        div.textContent = line;
        logBox.appendChild(div);
      });

      app.appendChild(logBox);
    }

    // Initial state
    logLine("New game started.");
    render();
  </script>
</body>
</html>
